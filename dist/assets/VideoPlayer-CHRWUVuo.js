import{Bt as e,C as t,E as n,H as r,I as i,It as a,Kt as o,L as s,Lt as c,R as l,Rt as u,T as d,W as f,qt as p,rt as m,w as h}from"./index-Aogkiv19.js";var g=p(o(),1),_=p(a(),1);const v=e=>{if(!e||e<0)return``;let t=Math.floor(e/3600),n=Math.floor(e%3600/60),r=Math.floor(e%60);return t===0?`${n.toString().padStart(2,`0`)}:${r.toString().padStart(2,`0`)}`:`${t}:${n.toString().padStart(2,`0`)}:${r.toString().padStart(2,`0`)}`},y=({referenceId:a,className:o,onCompleted:p})=>{let{t:v}=e(`videoPlayer`),{user:y}=r(),{activeContent:b}=d(),[x]=u(h),[S,C]=(0,g.useState)(!1),w=(0,g.useRef)(null),T=(0,g.useRef)(!1),{data:E,loading:D}=c(t,{variables:{id:a},skip:!a}),O=async()=>{if(b?.contentId)try{(await x({variables:{contentId:b.contentId,userId:y?.id}})).data?.markContentCompleted?.completed&&(C(!0),p?.(),n.getState().setShouldRefetch(!0))}catch(e){console.error(`Error marking video as completed:`,e)}};return(0,g.useEffect)(()=>{let e=document.createElement(`div`);e.id=`youtube-player`,e.className=o||``;let t=document.getElementById(`video-container`);if(t&&(t.innerHTML=``,t.appendChild(e)),!E||T.current)return;let n=(E.getLesson?.contents||[]).find(e=>e?.url?.toLowerCase().includes(`youtube.com/watch`))?.url;if(!n)return;let r=new URLSearchParams(new URL(n).search).get(`v`);if(!r)return;let i=()=>{!window.YT?.Player||!document.getElementById(`youtube-player`)||(w.current=new window.YT.Player(`youtube-player`,{height:`100%`,width:`100%`,videoId:r,playerVars:{autoplay:0,modestbranding:1,rel:0,enablejsapi:1},events:{onReady:()=>{T.current=!0},onStateChange:e=>{e.data===0&&O()},onError:e=>{console.error(`Player error:`,e)}}}))};if(!document.getElementById(`youtube-api`)){let e=document.createElement(`script`);e.id=`youtube-api`,e.src=`https://www.youtube.com/iframe_api`,document.head.appendChild(e)}return window.YT&&window.YT.Player?i():window.onYouTubeIframeAPIReady=i,()=>{w.current?.destroy&&(w.current.destroy(),T.current=!1)}},[E,o]),a?D?(0,_.jsx)(`div`,{className:`flex items-center justify-center h-full bg-gray-100`,children:(0,_.jsx)(`p`,{className:`text-gray-500`,children:v(`VideoPlayer.loading`)})}):(E?.getLesson?.contents||[]).find(e=>e?.url?.toLowerCase().includes(`youtube.com/watch`))?.url?(0,_.jsxs)(`div`,{className:`relative h-full`,children:[(0,_.jsx)(`div`,{id:`video-container`,className:`w-full h-full`}),S&&(0,_.jsx)(`div`,{className:`absolute top-4 right-4 w-80`,children:(0,_.jsxs)(i,{variant:`default`,className:`bg-white shadow-lg`,children:[(0,_.jsxs)(l,{className:`flex justify-between items-center`,children:[v(`VideoPlayer.completionAlert.title`),(0,_.jsx)(f,{variant:`ghost`,size:`sm`,onClick:()=>C(!1),children:(0,_.jsx)(m,{className:`h-4 w-4`})})]}),(0,_.jsx)(s,{children:v(`VideoPlayer.completionAlert.description`)})]})})]}):(0,_.jsx)(`div`,{className:`flex items-center justify-center h-full bg-gray-100`,children:(0,_.jsx)(`p`,{className:`text-gray-500`,children:v(`VideoPlayer.noUrl`)})}):(0,_.jsx)(`div`,{className:`flex items-center justify-center h-full bg-gray-100`,children:(0,_.jsx)(`p`,{className:`text-gray-500`,children:v(`VideoPlayer.noReference`)})})};var b=y;export{y as VideoPlayer,b as default,v as formatTimeFromSeconds};