import{i as e,n as t,r as n,t as r}from"./PasswordInput-qGHIUrC0.js";import{At as i,B as a,Bt as o,F as s,I as c,L as l,M as u,N as d,Pt as f,Rt as p,Vt as m,at as h,et as g,j as _,nt as v,tt as y,w as b,z as x}from"./index-DckVeK3o.js";var S=v(),C=m(o(),1),w;function T(e){return{lang:e?.lang??w?.lang,message:e?.message,abortEarly:e?.abortEarly??w?.abortEarly,abortPipeEarly:e?.abortPipeEarly??w?.abortPipeEarly}}var E;function D(e){return E?.get(e)}var O;function k(e){return O?.get(e)}var A;function j(e,t){return A?.get(e)?.get(t)}function M(e){let t=typeof e;return t===`string`?`"${e}"`:t===`number`||t===`bigint`||t===`boolean`?`${e}`:t===`object`||t===`function`?(e&&Object.getPrototypeOf(e)?.constructor?.name)??`null`:t}function N(e,t,n,r,i){let a=i&&`input`in i?i.input:n.value,o=i?.expected??e.expects??null,s=i?.received??M(a),c={kind:e.kind,type:e.type,input:a,expected:o,received:s,message:`Invalid ${t}: ${o?`Expected ${o} but r`:`R`}eceived ${s}`,requirement:e.requirement,path:i?.path,issues:i?.issues,lang:r.lang,abortEarly:r.abortEarly,abortPipeEarly:r.abortPipeEarly},l=e.kind===`schema`,u=i?.message??e.message??j(e.reference,c.lang)??(l?k(c.lang):null)??r.message??D(c.lang);u!==void 0&&(c.message=typeof u==`function`?u(c):u),l&&(n.typed=!1),n.issues?n.issues.push(c):n.issues=[c]}function P(e){return{version:1,vendor:`valibot`,validate(t){return e[`~run`]({value:t},T())}}}function F(e,t){return{kind:`validation`,type:`max_length`,reference:F,async:!1,expects:`<=${e}`,requirement:e,message:t,"~run"(e,t){return e.typed&&e.value.length>this.requirement&&N(this,`length`,e,t,{received:`${e.value.length}`}),e}}}function I(e,t){return{kind:`validation`,type:`min_length`,reference:I,async:!1,expects:`>=${e}`,requirement:e,message:t,"~run"(e,t){return e.typed&&e.value.length<this.requirement&&N(this,`length`,e,t,{received:`${e.value.length}`}),e}}}function L(e,t){return{kind:`validation`,type:`regex`,reference:L,async:!1,expects:`${e}`,requirement:e,message:t,"~run"(e,t){return e.typed&&!this.requirement.test(e.value)&&N(this,`format`,e,t),e}}}function R(e,t,n){return typeof e.fallback==`function`?e.fallback(t,n):e.fallback}function z(e,t,n){return typeof e.default==`function`?e.default(t,n):e.default}function B(e,t){return{kind:`schema`,type:`object`,reference:B,expects:`Object`,async:!1,entries:e,message:t,get"~standard"(){return P(this)},"~run"(e,t){let n=e.value;if(n&&typeof n==`object`)for(let r in e.typed=!0,e.value={},this.entries){let i=this.entries[r];if(r in n||(i.type===`exact_optional`||i.type===`optional`||i.type===`nullish`)&&i.default!==void 0){let a=r in n?n[r]:z(i),o=i[`~run`]({value:a},t);if(o.issues){let i={type:`object`,origin:`value`,input:n,key:r,value:a};for(let t of o.issues)t.path?t.path.unshift(i):t.path=[i],e.issues?.push(t);if(e.issues||=o.issues,t.abortEarly){e.typed=!1;break}}o.typed||(e.typed=!1),e.value[r]=o.value}else if(i.fallback!==void 0)e.value[r]=R(i);else if(i.type!==`exact_optional`&&i.type!==`optional`&&i.type!==`nullish`&&(N(this,`key`,e,t,{input:void 0,expected:`"${r}"`,path:[{type:`object`,origin:`key`,input:n,key:r,value:n[r]}]}),t.abortEarly))break}else N(this,`type`,e,t);return e}}}function V(e){return{kind:`schema`,type:`string`,reference:V,expects:`string`,async:!1,message:e,get"~standard"(){return P(this)},"~run"(e,t){return typeof e.value==`string`?e.typed=!0:N(this,`type`,e,t),e}}}function H(...e){return{...e[0],pipe:e,get"~standard"(){return P(this)},"~run"(t,n){for(let r of e)if(r.kind!==`metadata`){if(t.issues&&(r.kind===`schema`||r.kind===`transformation`)){t.typed=!1;break}(!t.issues||!n.abortEarly&&!n.abortPipeEarly)&&(t=r[`~run`](t,n))}return t}}}async function U(e,t,n){let r=await e[`~run`]({value:t},T(n));return{typed:r.typed,success:!r.issues,output:r.value,issues:r.issues}}const W=B({username:H(V(`Username is required`),I(2,`Username must be at least 2 characters`),F(50,`Username must be less than 50 characters`),L(/^[a-zA-Z0-9_-]+$/,`Username can only contain letters, numbers, underscores, and hyphens`)),email:H(V(`Email is required`),L(/^[^\s@]+@[^\s@]+\.[^\s@]+$/,`Please enter a valid email address`)),password:H(V(`Password is required`),I(6,`Password must be at least 6 characters`),F(100,`Password must be less than 100 characters`),L(/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)/,`Password must contain at least one uppercase letter, one lowercase letter, and one number`)),confirmPassword:V(`Please confirm your password`)}),G=async e=>{let t=await U(W,e);return t.success?e.password===e.confirmPassword?t:{success:!1,issues:[{message:`Passwords do not match`,path:[`confirmPassword`]}]}:t},K=({onSuccess:e,redirectToLogin:r=!0}={})=>{let{t:i}=f(),a=p(),[o,c]=(0,C.useState)(!1),[l,u]=(0,C.useState)(null);(0,C.useEffect)(()=>{t.getToken()&&a(`/chapters`)},[a]);let d=(0,C.useCallback)(async e=>{let t=await G(e);return t.success?{success:!0,data:e}:{success:!1,error:t.issues[0]?.message||i(`auth.invalidFormData`)}},[i]);return{register:(0,C.useCallback)(async t=>{c(!0),u(null);let o=await d(t);if(!o.success)return c(!1),{success:!1,error:o.error};let l=o.data;try{let t={name:l.username,email:l.email,password:l.password},o=await n.register(t);if(o.accessToken)return s.getState().setUser(o.user),e?e():a(r?`/login`:`/chapters`),{success:!0};{let e=i(`auth.registrationFailed`);return console.error(`Register response error:`,o),{success:!1,error:e}}}catch(e){let t=i(`auth.registrationFailed`);return e instanceof Error?(t=e.message.includes(`Email already exists`)?i(`auth.emailAlreadyExists`):e.message.includes(`Username already exists`)?i(`auth.usernameAlreadyExists`):`${e.message||i(`auth.registrationFailed`)} : ${i(`auth.tryAgain`)}`,console.error(`Register error:`,e),u(e)):console.error(`Unexpected error:`,e),{success:!1,error:t}}finally{c(!1)}},[a,e,r,i,d]),loading:o,error:l,validateForm:d}};var q=m(i(),1),J=`Label`,Y=C.forwardRef((e,t)=>(0,q.jsx)(b.label,{...e,ref:t,onMouseDown:t=>{t.target.closest(`button, input, select, textarea`)||(e.onMouseDown?.(t),!t.defaultPrevented&&t.detail>1&&t.preventDefault())}}));Y.displayName=J;var X=Y,Z=d(`text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70`),Q=C.forwardRef((e,t)=>{let n=(0,S.c)(9),r,i;n[0]===e?(r=n[1],i=n[2]):({className:r,...i}=e,n[0]=e,n[1]=r,n[2]=i);let a;n[3]===r?a=n[4]:(a=y(Z(),r),n[3]=r,n[4]=a);let o;return n[5]!==i||n[6]!==t||n[7]!==a?(o=(0,q.jsx)(X,{ref:t,className:a,...i}),n[5]=i,n[6]=t,n[7]=a,n[8]=o):o=n[8],o});Q.displayName=X.displayName;var $=v();function ee(e){let t=(0,$.c)(61),{onSubmit:n,loading:i,error:a}=e,o=i===void 0?!1:i,{t:s}=f(),c;t[0]===Symbol.for(`react.memo_cache_sentinel`)?(c={username:``,email:``,password:``,confirmPassword:``},t[0]=c):c=t[0];let[l,d]=(0,C.useState)(c),p;t[1]===Symbol.for(`react.memo_cache_sentinel`)?(p=e=>{let{name:t,value:n}=e.target;d(e=>({...e,[t]:n}))},t[1]=p):p=t[1];let m=p,_;t[2]!==l||t[3]!==n?(_=e=>{e.preventDefault(),n(l)},t[2]=l,t[3]=n,t[4]=_):_=t[4];let v=_,y;t[5]===Symbol.for(`react.memo_cache_sentinel`)?(y=(0,q.jsx)(Q,{htmlFor:`username`,children:`Username`}),t[5]=y):y=t[5];let b;t[6]!==l.username||t[7]!==o?(b=(0,q.jsxs)(h,{className:`space-y-2`,children:[y,(0,q.jsx)(g,{id:`username`,name:`username`,value:l.username,onChange:m,required:!0,disabled:o})]}),t[6]=l.username,t[7]=o,t[8]=b):b=t[8];let x;t[9]===s?x=t[10]:(x=s(`auth.email`),t[9]=s,t[10]=x);let S;t[11]===x?S=t[12]:(S=(0,q.jsx)(Q,{htmlFor:`email`,children:x}),t[11]=x,t[12]=S);let w;t[13]!==l.email||t[14]!==o?(w=(0,q.jsx)(g,{type:`email`,id:`email`,name:`email`,value:l.email,onChange:m,required:!0,disabled:o}),t[13]=l.email,t[14]=o,t[15]=w):w=t[15];let T;t[16]!==S||t[17]!==w?(T=(0,q.jsxs)(h,{className:`space-y-2`,children:[S,w]}),t[16]=S,t[17]=w,t[18]=T):T=t[18];let E;t[19]===s?E=t[20]:(E=s(`auth.password`),t[19]=s,t[20]=E);let D;t[21]===E?D=t[22]:(D=(0,q.jsx)(Q,{htmlFor:`password`,children:E}),t[21]=E,t[22]=D);let O=l.password,k;t[23]===Symbol.for(`react.memo_cache_sentinel`)?(k=e=>d(t=>({...t,password:e})),t[23]=k):k=t[23];let A;t[24]===s?A=t[25]:(A=s(`auth.password`),t[24]=s,t[25]=A);let j;t[26]!==l.password||t[27]!==A?(j=(0,q.jsx)(r,{id:`password`,value:O,onChange:k,placeholder:A}),t[26]=l.password,t[27]=A,t[28]=j):j=t[28];let M;t[29]!==D||t[30]!==j?(M=(0,q.jsxs)(h,{className:`space-y-2`,children:[D,j]}),t[29]=D,t[30]=j,t[31]=M):M=t[31];let N;t[32]===s?N=t[33]:(N=s(`auth.password`),t[32]=s,t[33]=N);let P;t[34]===N?P=t[35]:(P=(0,q.jsxs)(Q,{htmlFor:`confirmPassword`,children:[`Confirm `,N]}),t[34]=N,t[35]=P);let F=l.confirmPassword,I;t[36]===Symbol.for(`react.memo_cache_sentinel`)?(I=e=>d(t=>({...t,confirmPassword:e})),t[36]=I):I=t[36];let L;t[37]===s?L=t[38]:(L=s(`auth.password`),t[37]=s,t[38]=L);let R=`Confirm ${L}`,z;t[39]!==l.confirmPassword||t[40]!==R?(z=(0,q.jsx)(r,{id:`confirmPassword`,value:F,onChange:I,placeholder:R}),t[39]=l.confirmPassword,t[40]=R,t[41]=z):z=t[41];let B;t[42]!==P||t[43]!==z?(B=(0,q.jsxs)(h,{className:`space-y-2`,children:[P,z]}),t[42]=P,t[43]=z,t[44]=B):B=t[44];let V;t[45]!==o||t[46]!==s?(V=s(o?`auth.registering`:`auth.register`),t[45]=o,t[46]=s,t[47]=V):V=t[47];let H;t[48]!==o||t[49]!==V?(H=(0,q.jsx)(u,{type:`submit`,className:`w-full`,disabled:o,children:V}),t[48]=o,t[49]=V,t[50]=H):H=t[50];let U;t[51]===a?U=t[52]:(U=a&&(0,q.jsx)(`div`,{className:`text-red-500 text-sm mt-2 text-center`,children:a}),t[51]=a,t[52]=U);let W;return t[53]!==v||t[54]!==T||t[55]!==M||t[56]!==B||t[57]!==H||t[58]!==U||t[59]!==b?(W=(0,q.jsxs)(`form`,{onSubmit:v,className:`space-y-4`,children:[b,T,M,B,H,U]}),t[53]=v,t[54]=T,t[55]=M,t[56]=B,t[57]=H,t[58]=U,t[59]=b,t[60]=W):W=t[60],W}var te=v();function ne(){let t=(0,te.c)(16),{t:n}=f(),r;t[0]===Symbol.for(`react.memo_cache_sentinel`)?(r={redirectToLogin:!0},t[0]=r):r=t[0];let{register:i,loading:o,error:s}=K(r),u;t[1]===i?u=t[2]:(u=async e=>{await i(e)},t[1]=i,t[2]=u);let d=u,p;t[3]===Symbol.for(`react.memo_cache_sentinel`)?(p={backgroundImage:`url(${e})`},t[3]=p):p=t[3];let m;t[4]===Symbol.for(`react.memo_cache_sentinel`)?(m=(0,q.jsx)(`img`,{src:_,alt:`Logo`,className:`w-32 h-auto mb-4`}),t[4]=m):m=t[4];let h;t[5]===n?h=t[6]:(h=n(`auth.register`),t[5]=n,t[6]=h);let g;t[7]===h?g=t[8]:(g=(0,q.jsx)(x,{className:`pb-4`,children:(0,q.jsxs)(`div`,{className:`flex flex-col items-center mb-4`,children:[m,(0,q.jsx)(a,{className:`text-2xl font-semibold text-gray-800`,children:h})]})}),t[7]=h,t[8]=g);let v=s?.message||void 0,y;t[9]!==d||t[10]!==o||t[11]!==v?(y=(0,q.jsx)(l,{className:`pt-0`,children:(0,q.jsx)(ee,{onSubmit:d,loading:o,error:v})}),t[9]=d,t[10]=o,t[11]=v,t[12]=y):y=t[12];let b;return t[13]!==g||t[14]!==y?(b=(0,q.jsx)(`div`,{className:`min-h-screen flex items-center justify-center bg-cover bg-center`,style:p,children:(0,q.jsxs)(c,{className:`w-full max-w-md shadow-lg border-0 backdrop-blur-xs`,children:[g,y]})}),t[13]=g,t[14]=y,t[15]=b):b=t[15],b}export{ne as default};