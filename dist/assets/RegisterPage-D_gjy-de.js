import{t as e}from"./label-CSRWJp9Q.js";import{i as t,n,r,t as i}from"./PasswordInput-m8wWLaIe.js";import{A as a,Bt as o,F as s,Gt as c,R as l,Xt as u,en as d,j as f,k as p,tn as m}from"./index-DVxlyxEz.js";import{i as h,n as g,r as _,t as v}from"./card-B940mmLx.js";import{t as y}from"./input-Bu4gmI-v.js";var b=s(),x=m(d(),1),S;function C(e){return{lang:e?.lang??S?.lang,message:e?.message,abortEarly:e?.abortEarly??S?.abortEarly,abortPipeEarly:e?.abortPipeEarly??S?.abortPipeEarly}}var w;function T(e){return w?.get(e)}var E;function D(e){return E?.get(e)}var O;function k(e,t){return O?.get(e)?.get(t)}function A(e){let t=typeof e;return t===`string`?`"${e}"`:t===`number`||t===`bigint`||t===`boolean`?`${e}`:t===`object`||t===`function`?(e&&Object.getPrototypeOf(e)?.constructor?.name)??`null`:t}function j(e,t,n,r,i){let a=i&&`input`in i?i.input:n.value,o=i?.expected??e.expects??null,s=i?.received??A(a),c={kind:e.kind,type:e.type,input:a,expected:o,received:s,message:`Invalid ${t}: ${o?`Expected ${o} but r`:`R`}eceived ${s}`,requirement:e.requirement,path:i?.path,issues:i?.issues,lang:r.lang,abortEarly:r.abortEarly,abortPipeEarly:r.abortPipeEarly},l=e.kind===`schema`,u=i?.message??e.message??k(e.reference,c.lang)??(l?D(c.lang):null)??r.message??T(c.lang);u!==void 0&&(c.message=typeof u==`function`?u(c):u),l&&(n.typed=!1),n.issues?n.issues.push(c):n.issues=[c]}function M(e){return{version:1,vendor:`valibot`,validate(t){return e[`~run`]({value:t},C())}}}function N(e,t){return{kind:`validation`,type:`max_length`,reference:N,async:!1,expects:`<=${e}`,requirement:e,message:t,"~run"(e,t){return e.typed&&e.value.length>this.requirement&&j(this,`length`,e,t,{received:`${e.value.length}`}),e}}}function P(e,t){return{kind:`validation`,type:`min_length`,reference:P,async:!1,expects:`>=${e}`,requirement:e,message:t,"~run"(e,t){return e.typed&&e.value.length<this.requirement&&j(this,`length`,e,t,{received:`${e.value.length}`}),e}}}function F(e,t){return{kind:`validation`,type:`regex`,reference:F,async:!1,expects:`${e}`,requirement:e,message:t,"~run"(e,t){return e.typed&&!this.requirement.test(e.value)&&j(this,`format`,e,t),e}}}function I(e,t,n){return typeof e.fallback==`function`?e.fallback(t,n):e.fallback}function L(e,t,n){return typeof e.default==`function`?e.default(t,n):e.default}function R(e,t){return{kind:`schema`,type:`object`,reference:R,expects:`Object`,async:!1,entries:e,message:t,get"~standard"(){return M(this)},"~run"(e,t){let n=e.value;if(n&&typeof n==`object`)for(let r in e.typed=!0,e.value={},this.entries){let i=this.entries[r];if(r in n||(i.type===`exact_optional`||i.type===`optional`||i.type===`nullish`)&&i.default!==void 0){let a=r in n?n[r]:L(i),o=i[`~run`]({value:a},t);if(o.issues){let i={type:`object`,origin:`value`,input:n,key:r,value:a};for(let t of o.issues)t.path?t.path.unshift(i):t.path=[i],e.issues?.push(t);if(e.issues||=o.issues,t.abortEarly){e.typed=!1;break}}o.typed||(e.typed=!1),e.value[r]=o.value}else if(i.fallback!==void 0)e.value[r]=I(i);else if(i.type!==`exact_optional`&&i.type!==`optional`&&i.type!==`nullish`&&(j(this,`key`,e,t,{input:void 0,expected:`"${r}"`,path:[{type:`object`,origin:`key`,input:n,key:r,value:n[r]}]}),t.abortEarly))break}else j(this,`type`,e,t);return e}}}function z(e){return{kind:`schema`,type:`string`,reference:z,expects:`string`,async:!1,message:e,get"~standard"(){return M(this)},"~run"(e,t){return typeof e.value==`string`?e.typed=!0:j(this,`type`,e,t),e}}}function B(...e){return{...e[0],pipe:e,get"~standard"(){return M(this)},"~run"(t,n){for(let r of e)if(r.kind!==`metadata`){if(t.issues&&(r.kind===`schema`||r.kind===`transformation`)){t.typed=!1;break}(!t.issues||!n.abortEarly&&!n.abortPipeEarly)&&(t=r[`~run`](t,n))}return t}}}async function V(e,t,n){let r=await e[`~run`]({value:t},C(n));return{typed:r.typed,success:!r.issues,output:r.value,issues:r.issues}}const H=R({username:B(z(`Username is required`),P(2,`Username must be at least 2 characters`),N(50,`Username must be less than 50 characters`),F(/^[a-zA-Z0-9_-]+$/,`Username can only contain letters, numbers, underscores, and hyphens`)),email:B(z(`Email is required`),F(/^[^\s@]+@[^\s@]+\.[^\s@]+$/,`Please enter a valid email address`)),password:B(z(`Password is required`),P(6,`Password must be at least 6 characters`),N(100,`Password must be less than 100 characters`),F(/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)/,`Password must contain at least one uppercase letter, one lowercase letter, and one number`)),confirmPassword:z(`Please confirm your password`)}),U=async e=>{let t=await V(H,e);return t.success?e.password===e.confirmPassword?t:{success:!1,issues:[{message:`Passwords do not match`,path:[`confirmPassword`]}]}:t},W=({onSuccess:e,redirectToLogin:t=!0}={})=>{let{t:i}=c(),a=u(),[o,s]=(0,x.useState)(!1),[l,d]=(0,x.useState)(null);(0,x.useEffect)(()=>{n.getToken()&&a(`/chapters`)},[a]);let f=(0,x.useCallback)(async e=>{let t=await U(e);return t.success?{success:!0,data:e}:{success:!1,error:t.issues[0]?.message||i(`auth.invalidFormData`)}},[i]);return{register:(0,x.useCallback)(async n=>{s(!0),d(null);let o=await f(n);if(!o.success)return s(!1),{success:!1,error:o.error};let c=o.data;try{let n={name:c.username,email:c.email,password:c.password},o=await r.register(n);if(o.accessToken)return p.getState().setUser(o.user),e?e():a(t?`/login`:`/chapters`),{success:!0};{let e=i(`auth.registrationFailed`);return console.error(`Register response error:`,o),{success:!1,error:e}}}catch(e){let t=i(`auth.registrationFailed`);return e instanceof Error?(t=e.message.includes(`Email already exists`)?i(`auth.emailAlreadyExists`):e.message.includes(`Username already exists`)?i(`auth.usernameAlreadyExists`):`${e.message||i(`auth.registrationFailed`)} : ${i(`auth.tryAgain`)}`,console.error(`Register error:`,e),d(e)):console.error(`Unexpected error:`,e),{success:!1,error:t}}finally{s(!1)}},[a,e,t,i,f]),loading:o,error:l,validateForm:f}};var G=m(o(),1);function K(t){let n=(0,b.c)(61),{onSubmit:r,loading:a,error:o}=t,s=a===void 0?!1:a,{t:u}=c(),d;n[0]===Symbol.for(`react.memo_cache_sentinel`)?(d={username:``,email:``,password:``,confirmPassword:``},n[0]=d):d=n[0];let[p,m]=(0,x.useState)(d),h;n[1]===Symbol.for(`react.memo_cache_sentinel`)?(h=e=>{let{name:t,value:n}=e.target;m(e=>({...e,[t]:n}))},n[1]=h):h=n[1];let g=h,_;n[2]!==p||n[3]!==r?(_=e=>{e.preventDefault(),r(p)},n[2]=p,n[3]=r,n[4]=_):_=n[4];let v=_,S;n[5]===Symbol.for(`react.memo_cache_sentinel`)?(S=(0,G.jsx)(e,{htmlFor:`username`,children:`Username`}),n[5]=S):S=n[5];let C;n[6]!==p.username||n[7]!==s?(C=(0,G.jsxs)(l,{className:`space-y-2`,children:[S,(0,G.jsx)(y,{id:`username`,name:`username`,value:p.username,onChange:g,required:!0,disabled:s})]}),n[6]=p.username,n[7]=s,n[8]=C):C=n[8];let w;n[9]===u?w=n[10]:(w=u(`auth.email`),n[9]=u,n[10]=w);let T;n[11]===w?T=n[12]:(T=(0,G.jsx)(e,{htmlFor:`email`,children:w}),n[11]=w,n[12]=T);let E;n[13]!==p.email||n[14]!==s?(E=(0,G.jsx)(y,{type:`email`,id:`email`,name:`email`,value:p.email,onChange:g,required:!0,disabled:s}),n[13]=p.email,n[14]=s,n[15]=E):E=n[15];let D;n[16]!==T||n[17]!==E?(D=(0,G.jsxs)(l,{className:`space-y-2`,children:[T,E]}),n[16]=T,n[17]=E,n[18]=D):D=n[18];let O;n[19]===u?O=n[20]:(O=u(`auth.password`),n[19]=u,n[20]=O);let k;n[21]===O?k=n[22]:(k=(0,G.jsx)(e,{htmlFor:`password`,children:O}),n[21]=O,n[22]=k);let A=p.password,j;n[23]===Symbol.for(`react.memo_cache_sentinel`)?(j=e=>m(t=>({...t,password:e})),n[23]=j):j=n[23];let M;n[24]===u?M=n[25]:(M=u(`auth.password`),n[24]=u,n[25]=M);let N;n[26]!==p.password||n[27]!==M?(N=(0,G.jsx)(i,{id:`password`,value:A,onChange:j,placeholder:M}),n[26]=p.password,n[27]=M,n[28]=N):N=n[28];let P;n[29]!==k||n[30]!==N?(P=(0,G.jsxs)(l,{className:`space-y-2`,children:[k,N]}),n[29]=k,n[30]=N,n[31]=P):P=n[31];let F;n[32]===u?F=n[33]:(F=u(`auth.password`),n[32]=u,n[33]=F);let I;n[34]===F?I=n[35]:(I=(0,G.jsxs)(e,{htmlFor:`confirmPassword`,children:[`Confirm `,F]}),n[34]=F,n[35]=I);let L=p.confirmPassword,R;n[36]===Symbol.for(`react.memo_cache_sentinel`)?(R=e=>m(t=>({...t,confirmPassword:e})),n[36]=R):R=n[36];let z;n[37]===u?z=n[38]:(z=u(`auth.password`),n[37]=u,n[38]=z);let B=`Confirm ${z}`,V;n[39]!==p.confirmPassword||n[40]!==B?(V=(0,G.jsx)(i,{id:`confirmPassword`,value:L,onChange:R,placeholder:B}),n[39]=p.confirmPassword,n[40]=B,n[41]=V):V=n[41];let H;n[42]!==I||n[43]!==V?(H=(0,G.jsxs)(l,{className:`space-y-2`,children:[I,V]}),n[42]=I,n[43]=V,n[44]=H):H=n[44];let U;n[45]!==s||n[46]!==u?(U=u(s?`auth.registering`:`auth.register`),n[45]=s,n[46]=u,n[47]=U):U=n[47];let W;n[48]!==s||n[49]!==U?(W=(0,G.jsx)(f,{type:`submit`,className:`w-full`,disabled:s,children:U}),n[48]=s,n[49]=U,n[50]=W):W=n[50];let K;n[51]===o?K=n[52]:(K=o&&(0,G.jsx)(`div`,{className:`text-red-500 text-sm mt-2 text-center`,children:o}),n[51]=o,n[52]=K);let q;return n[53]!==v||n[54]!==D||n[55]!==P||n[56]!==H||n[57]!==W||n[58]!==K||n[59]!==C?(q=(0,G.jsxs)(`form`,{onSubmit:v,className:`space-y-4`,children:[C,D,P,H,W,K]}),n[53]=v,n[54]=D,n[55]=P,n[56]=H,n[57]=W,n[58]=K,n[59]=C,n[60]=q):q=n[60],q}var q=s();function J(){let e=(0,q.c)(16),{t:n}=c(),r;e[0]===Symbol.for(`react.memo_cache_sentinel`)?(r={redirectToLogin:!0},e[0]=r):r=e[0];let{register:i,loading:o,error:s}=W(r),l;e[1]===i?l=e[2]:(l=async e=>{await i(e)},e[1]=i,e[2]=l);let u=l,d;e[3]===Symbol.for(`react.memo_cache_sentinel`)?(d={backgroundImage:`url(${t})`},e[3]=d):d=e[3];let f;e[4]===Symbol.for(`react.memo_cache_sentinel`)?(f=(0,G.jsx)(`img`,{src:a,alt:`Logo`,className:`w-32 h-auto mb-4`}),e[4]=f):f=e[4];let p;e[5]===n?p=e[6]:(p=n(`auth.register`),e[5]=n,e[6]=p);let m;e[7]===p?m=e[8]:(m=(0,G.jsx)(_,{className:`pb-4`,children:(0,G.jsxs)(`div`,{className:`flex flex-col items-center mb-4`,children:[f,(0,G.jsx)(h,{className:`text-2xl font-semibold text-gray-800`,children:p})]})}),e[7]=p,e[8]=m);let y=s?.message||void 0,b;e[9]!==u||e[10]!==o||e[11]!==y?(b=(0,G.jsx)(g,{className:`pt-0`,children:(0,G.jsx)(K,{onSubmit:u,loading:o,error:y})}),e[9]=u,e[10]=o,e[11]=y,e[12]=b):b=e[12];let x;return e[13]!==m||e[14]!==b?(x=(0,G.jsx)(`div`,{className:`min-h-screen flex items-center justify-center bg-cover bg-center`,style:d,children:(0,G.jsxs)(v,{className:`w-full max-w-md shadow-lg border-0 backdrop-blur-xs`,children:[m,b]})}),e[13]=m,e[14]=b,e[15]=x):x=e[15],x}export{J as default};