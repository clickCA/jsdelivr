import{i as e,n as t,r as n,t as r}from"./PasswordInput-Dq5YdC3b.js";import{Bt as i,G as a,H as o,It as s,J as c,K as l,Kt as u,U as d,Ut as f,W as p,ht as m,k as h,pt as g,q as _,qt as v,vt as y}from"./index-Aogkiv19.js";var b=m(),x=v(u(),1),S;function C(e){return{lang:e?.lang??S?.lang,message:e?.message,abortEarly:e?.abortEarly??S?.abortEarly,abortPipeEarly:e?.abortPipeEarly??S?.abortPipeEarly}}var w;function T(e){return w?.get(e)}var E;function D(e){return E?.get(e)}var O;function k(e,t){return O?.get(e)?.get(t)}function A(e){let t=typeof e;return t===`string`?`"${e}"`:t===`number`||t===`bigint`||t===`boolean`?`${e}`:t===`object`||t===`function`?(e&&Object.getPrototypeOf(e)?.constructor?.name)??`null`:t}function j(e,t,n,r,i){let a=i&&`input`in i?i.input:n.value,o=i?.expected??e.expects??null,s=i?.received??A(a),c={kind:e.kind,type:e.type,input:a,expected:o,received:s,message:`Invalid ${t}: ${o?`Expected ${o} but r`:`R`}eceived ${s}`,requirement:e.requirement,path:i?.path,issues:i?.issues,lang:r.lang,abortEarly:r.abortEarly,abortPipeEarly:r.abortPipeEarly},l=e.kind===`schema`,u=i?.message??e.message??k(e.reference,c.lang)??(l?D(c.lang):null)??r.message??T(c.lang);u!==void 0&&(c.message=typeof u==`function`?u(c):u),l&&(n.typed=!1),n.issues?n.issues.push(c):n.issues=[c]}function M(e){return{version:1,vendor:`valibot`,validate(t){return e[`~run`]({value:t},C())}}}function N(e,t){return{kind:`validation`,type:`max_length`,reference:N,async:!1,expects:`<=${e}`,requirement:e,message:t,"~run"(e,t){return e.typed&&e.value.length>this.requirement&&j(this,`length`,e,t,{received:`${e.value.length}`}),e}}}function P(e,t){return{kind:`validation`,type:`min_length`,reference:P,async:!1,expects:`>=${e}`,requirement:e,message:t,"~run"(e,t){return e.typed&&e.value.length<this.requirement&&j(this,`length`,e,t,{received:`${e.value.length}`}),e}}}function F(e,t){return{kind:`validation`,type:`regex`,reference:F,async:!1,expects:`${e}`,requirement:e,message:t,"~run"(e,t){return e.typed&&!this.requirement.test(e.value)&&j(this,`format`,e,t),e}}}function I(e,t,n){return typeof e.fallback==`function`?e.fallback(t,n):e.fallback}function L(e,t,n){return typeof e.default==`function`?e.default(t,n):e.default}function R(e,t){return{kind:`schema`,type:`object`,reference:R,expects:`Object`,async:!1,entries:e,message:t,get"~standard"(){return M(this)},"~run"(e,t){let n=e.value;if(n&&typeof n==`object`)for(let r in e.typed=!0,e.value={},this.entries){let i=this.entries[r];if(r in n||(i.type===`exact_optional`||i.type===`optional`||i.type===`nullish`)&&i.default!==void 0){let a=r in n?n[r]:L(i),o=i[`~run`]({value:a},t);if(o.issues){let i={type:`object`,origin:`value`,input:n,key:r,value:a};for(let t of o.issues)t.path?t.path.unshift(i):t.path=[i],e.issues?.push(t);if(e.issues||=o.issues,t.abortEarly){e.typed=!1;break}}o.typed||(e.typed=!1),e.value[r]=o.value}else if(i.fallback!==void 0)e.value[r]=I(i);else if(i.type!==`exact_optional`&&i.type!==`optional`&&i.type!==`nullish`&&(j(this,`key`,e,t,{input:void 0,expected:`"${r}"`,path:[{type:`object`,origin:`key`,input:n,key:r,value:n[r]}]}),t.abortEarly))break}else j(this,`type`,e,t);return e}}}function z(e){return{kind:`schema`,type:`string`,reference:z,expects:`string`,async:!1,message:e,get"~standard"(){return M(this)},"~run"(e,t){return typeof e.value==`string`?e.typed=!0:j(this,`type`,e,t),e}}}function B(...e){return{...e[0],pipe:e,get"~standard"(){return M(this)},"~run"(t,n){for(let r of e)if(r.kind!==`metadata`){if(t.issues&&(r.kind===`schema`||r.kind===`transformation`)){t.typed=!1;break}(!t.issues||!n.abortEarly&&!n.abortPipeEarly)&&(t=r[`~run`](t,n))}return t}}}async function V(e,t,n){let r=await e[`~run`]({value:t},C(n));return{typed:r.typed,success:!r.issues,output:r.value,issues:r.issues}}const H=R({username:B(z(`Username is required`),P(2,`Username must be at least 2 characters`),N(50,`Username must be less than 50 characters`),F(/^[a-zA-Z0-9_-]+$/,`Username can only contain letters, numbers, underscores, and hyphens`)),email:B(z(`Email is required`),F(/^[^\s@]+@[^\s@]+\.[^\s@]+$/,`Please enter a valid email address`)),password:B(z(`Password is required`),P(6,`Password must be at least 6 characters`),N(100,`Password must be less than 100 characters`),F(/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)/,`Password must contain at least one uppercase letter, one lowercase letter, and one number`)),confirmPassword:z(`Please confirm your password`)}),U=async e=>{let t=await V(H,e);return t.success?e.password===e.confirmPassword?t:{success:!1,issues:[{message:`Passwords do not match`,path:[`confirmPassword`]}]}:t},W=({onSuccess:e,redirectToLogin:r=!0}={})=>{let{t:a}=i(),s=f(),[c,l]=(0,x.useState)(!1),[u,d]=(0,x.useState)(null);(0,x.useEffect)(()=>{t.getToken()&&s(`/chapters`)},[s]);let p=(0,x.useCallback)(async e=>{let t=await U(e);return t.success?{success:!0,data:e}:{success:!1,error:t.issues[0]?.message||a(`auth.invalidFormData`)}},[a]);return{register:(0,x.useCallback)(async t=>{l(!0),d(null);let i=await p(t);if(!i.success)return l(!1),{success:!1,error:i.error};let c=i.data;try{let t={name:c.username,email:c.email,password:c.password},i=await n.register(t);if(i.accessToken)return o.getState().setUser(i.user),e?e():s(r?`/login`:`/chapters`),{success:!0};{let e=a(`auth.registrationFailed`);return console.error(`Register response error:`,i),{success:!1,error:e}}}catch(e){let t=a(`auth.registrationFailed`);return e instanceof Error?(t=e.message.includes(`Email already exists`)?a(`auth.emailAlreadyExists`):e.message.includes(`Username already exists`)?a(`auth.usernameAlreadyExists`):`${e.message||a(`auth.registrationFailed`)} : ${a(`auth.tryAgain`)}`,console.error(`Register error:`,e),d(e)):console.error(`Unexpected error:`,e),{success:!1,error:t}}finally{l(!1)}},[s,e,r,a,p]),loading:c,error:u,validateForm:p}};var G=v(s(),1);function K(e){let t=(0,b.c)(61),{onSubmit:n,loading:a,error:o}=e,s=a===void 0?!1:a,{t:c}=i(),l;t[0]===Symbol.for(`react.memo_cache_sentinel`)?(l={username:``,email:``,password:``,confirmPassword:``},t[0]=l):l=t[0];let[u,d]=(0,x.useState)(l),f;t[1]===Symbol.for(`react.memo_cache_sentinel`)?(f=e=>{let{name:t,value:n}=e.target;d(e=>({...e,[t]:n}))},t[1]=f):f=t[1];let m=f,_;t[2]!==u||t[3]!==n?(_=e=>{e.preventDefault(),n(u)},t[2]=u,t[3]=n,t[4]=_):_=t[4];let v=_,S;t[5]===Symbol.for(`react.memo_cache_sentinel`)?(S=(0,G.jsx)(h,{htmlFor:`username`,children:`Username`}),t[5]=S):S=t[5];let C;t[6]!==u.username||t[7]!==s?(C=(0,G.jsxs)(y,{className:`space-y-2`,children:[S,(0,G.jsx)(g,{id:`username`,name:`username`,value:u.username,onChange:m,required:!0,disabled:s})]}),t[6]=u.username,t[7]=s,t[8]=C):C=t[8];let w;t[9]===c?w=t[10]:(w=c(`auth.email`),t[9]=c,t[10]=w);let T;t[11]===w?T=t[12]:(T=(0,G.jsx)(h,{htmlFor:`email`,children:w}),t[11]=w,t[12]=T);let E;t[13]!==u.email||t[14]!==s?(E=(0,G.jsx)(g,{type:`email`,id:`email`,name:`email`,value:u.email,onChange:m,required:!0,disabled:s}),t[13]=u.email,t[14]=s,t[15]=E):E=t[15];let D;t[16]!==T||t[17]!==E?(D=(0,G.jsxs)(y,{className:`space-y-2`,children:[T,E]}),t[16]=T,t[17]=E,t[18]=D):D=t[18];let O;t[19]===c?O=t[20]:(O=c(`auth.password`),t[19]=c,t[20]=O);let k;t[21]===O?k=t[22]:(k=(0,G.jsx)(h,{htmlFor:`password`,children:O}),t[21]=O,t[22]=k);let A=u.password,j;t[23]===Symbol.for(`react.memo_cache_sentinel`)?(j=e=>d(t=>({...t,password:e})),t[23]=j):j=t[23];let M;t[24]===c?M=t[25]:(M=c(`auth.password`),t[24]=c,t[25]=M);let N;t[26]!==u.password||t[27]!==M?(N=(0,G.jsx)(r,{id:`password`,value:A,onChange:j,placeholder:M}),t[26]=u.password,t[27]=M,t[28]=N):N=t[28];let P;t[29]!==k||t[30]!==N?(P=(0,G.jsxs)(y,{className:`space-y-2`,children:[k,N]}),t[29]=k,t[30]=N,t[31]=P):P=t[31];let F;t[32]===c?F=t[33]:(F=c(`auth.password`),t[32]=c,t[33]=F);let I;t[34]===F?I=t[35]:(I=(0,G.jsxs)(h,{htmlFor:`confirmPassword`,children:[`Confirm `,F]}),t[34]=F,t[35]=I);let L=u.confirmPassword,R;t[36]===Symbol.for(`react.memo_cache_sentinel`)?(R=e=>d(t=>({...t,confirmPassword:e})),t[36]=R):R=t[36];let z;t[37]===c?z=t[38]:(z=c(`auth.password`),t[37]=c,t[38]=z);let B=`Confirm ${z}`,V;t[39]!==u.confirmPassword||t[40]!==B?(V=(0,G.jsx)(r,{id:`confirmPassword`,value:L,onChange:R,placeholder:B}),t[39]=u.confirmPassword,t[40]=B,t[41]=V):V=t[41];let H;t[42]!==I||t[43]!==V?(H=(0,G.jsxs)(y,{className:`space-y-2`,children:[I,V]}),t[42]=I,t[43]=V,t[44]=H):H=t[44];let U;t[45]!==s||t[46]!==c?(U=c(s?`auth.registering`:`auth.register`),t[45]=s,t[46]=c,t[47]=U):U=t[47];let W;t[48]!==s||t[49]!==U?(W=(0,G.jsx)(p,{type:`submit`,className:`w-full`,disabled:s,children:U}),t[48]=s,t[49]=U,t[50]=W):W=t[50];let K;t[51]===o?K=t[52]:(K=o&&(0,G.jsx)(`div`,{className:`text-red-500 text-sm mt-2 text-center`,children:o}),t[51]=o,t[52]=K);let q;return t[53]!==v||t[54]!==D||t[55]!==P||t[56]!==H||t[57]!==W||t[58]!==K||t[59]!==C?(q=(0,G.jsxs)(`form`,{onSubmit:v,className:`space-y-4`,children:[C,D,P,H,W,K]}),t[53]=v,t[54]=D,t[55]=P,t[56]=H,t[57]=W,t[58]=K,t[59]=C,t[60]=q):q=t[60],q}var q=m();function J(){let t=(0,q.c)(16),{t:n}=i(),r;t[0]===Symbol.for(`react.memo_cache_sentinel`)?(r={redirectToLogin:!0},t[0]=r):r=t[0];let{register:o,loading:s,error:u}=W(r),f;t[1]===o?f=t[2]:(f=async e=>{await o(e)},t[1]=o,t[2]=f);let p=f,m;t[3]===Symbol.for(`react.memo_cache_sentinel`)?(m={backgroundImage:`url(${e})`},t[3]=m):m=t[3];let h;t[4]===Symbol.for(`react.memo_cache_sentinel`)?(h=(0,G.jsx)(`img`,{src:d,alt:`Logo`,className:`w-32 h-auto mb-4`}),t[4]=h):h=t[4];let g;t[5]===n?g=t[6]:(g=n(`auth.register`),t[5]=n,t[6]=g);let v;t[7]===g?v=t[8]:(v=(0,G.jsx)(_,{className:`pb-4`,children:(0,G.jsxs)(`div`,{className:`flex flex-col items-center mb-4`,children:[h,(0,G.jsx)(c,{className:`text-2xl font-semibold text-gray-800`,children:g})]})}),t[7]=g,t[8]=v);let y=u?.message||void 0,b;t[9]!==p||t[10]!==s||t[11]!==y?(b=(0,G.jsx)(l,{className:`pt-0`,children:(0,G.jsx)(K,{onSubmit:p,loading:s,error:y})}),t[9]=p,t[10]=s,t[11]=y,t[12]=b):b=t[12];let x;return t[13]!==v||t[14]!==b?(x=(0,G.jsx)(`div`,{className:`min-h-screen flex items-center justify-center bg-cover bg-center`,style:m,children:(0,G.jsxs)(a,{className:`w-full max-w-md shadow-lg border-0 backdrop-blur-xs`,children:[v,b]})}),t[13]=v,t[14]=b,t[15]=x):x=t[15],x}export{J as default};