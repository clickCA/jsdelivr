import{t as e}from"./x-BsaIYSsg.js";import{At as t,Bt as n,D as r,E as i,F as a,M as o,Mt as s,O as c,Pt as l,Vt as u,jt as d,k as f}from"./index-BBzmVm7X.js";import{n as p,r as m,t as h}from"./alert-2kuSYxe-.js";var g=u(n(),1),_=u(t(),1);const v=e=>{if(!e||e<0)return``;let t=Math.floor(e/3600),n=Math.floor(e%3600/60),r=Math.floor(e%60);return t===0?`${n.toString().padStart(2,`0`)}:${r.toString().padStart(2,`0`)}`:`${t}:${n.toString().padStart(2,`0`)}:${r.toString().padStart(2,`0`)}`},y=({referenceId:t,className:n,onCompleted:u})=>{let{t:v}=l(`videoPlayer`),{user:y}=a(),{activeContent:b}=c(),[x]=s(r),[S,C]=(0,g.useState)(!1),w=(0,g.useRef)(null),T=(0,g.useRef)(!1),{data:E,loading:D}=d(i,{variables:{id:t},skip:!t}),O=async()=>{if(b?.contentId)try{(await x({variables:{contentId:b.contentId,userId:y?.id}})).data?.markContentCompleted?.completed&&(C(!0),u?.(),f.getState().setShouldRefetch(!0))}catch(e){console.error(`Error marking video as completed:`,e)}};return(0,g.useEffect)(()=>{let e=document.createElement(`div`);e.id=`youtube-player`,e.className=n||``;let t=document.getElementById(`video-container`);if(t&&(t.innerHTML=``,t.appendChild(e)),!E||T.current)return;let r=(E.getLesson?.contents||[]).find(e=>e?.url?.toLowerCase().includes(`youtube.com/watch`))?.url;if(!r)return;let i=new URLSearchParams(new URL(r).search).get(`v`);if(!i)return;let a=()=>{!window.YT?.Player||!document.getElementById(`youtube-player`)||(w.current=new window.YT.Player(`youtube-player`,{height:`100%`,width:`100%`,videoId:i,playerVars:{autoplay:0,modestbranding:1,rel:0,enablejsapi:1},events:{onReady:()=>{T.current=!0},onStateChange:e=>{e.data===0&&O()},onError:e=>{console.error(`Player error:`,e)}}}))};if(!document.getElementById(`youtube-api`)){let e=document.createElement(`script`);e.id=`youtube-api`,e.src=`https://www.youtube.com/iframe_api`,document.head.appendChild(e)}return window.YT&&window.YT.Player?a():window.onYouTubeIframeAPIReady=a,()=>{w.current?.destroy&&(w.current.destroy(),T.current=!1)}},[E,n]),t?D?(0,_.jsx)(`div`,{className:`flex items-center justify-center h-full bg-gray-100`,children:(0,_.jsx)(`p`,{className:`text-gray-500`,children:v(`VideoPlayer.loading`)})}):(E?.getLesson?.contents||[]).find(e=>e?.url?.toLowerCase().includes(`youtube.com/watch`))?.url?(0,_.jsxs)(`div`,{className:`relative h-full`,children:[(0,_.jsx)(`div`,{id:`video-container`,className:`w-full h-full`}),S&&(0,_.jsx)(`div`,{className:`absolute top-4 right-4 w-80`,children:(0,_.jsxs)(h,{variant:`default`,className:`bg-white shadow-lg`,children:[(0,_.jsxs)(m,{className:`flex justify-between items-center`,children:[v(`VideoPlayer.completionAlert.title`),(0,_.jsx)(o,{variant:`ghost`,size:`sm`,onClick:()=>C(!1),children:(0,_.jsx)(e,{className:`h-4 w-4`})})]}),(0,_.jsx)(p,{children:v(`VideoPlayer.completionAlert.description`)})]})})]}):(0,_.jsx)(`div`,{className:`flex items-center justify-center h-full bg-gray-100`,children:(0,_.jsx)(`p`,{className:`text-gray-500`,children:v(`VideoPlayer.noUrl`)})}):(0,_.jsx)(`div`,{className:`flex items-center justify-center h-full bg-gray-100`,children:(0,_.jsx)(`p`,{className:`text-gray-500`,children:v(`VideoPlayer.noReference`)})})};var b=y;export{y as VideoPlayer,b as default,v as formatTimeFromSeconds};